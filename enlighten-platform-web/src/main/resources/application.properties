spring.application.name=enlighten-platform-web

# 数据库连接配置
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://localhost:3306/enlighten_platform?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&createDatabaseIfNotExist=true}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:root}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:}

# 避免 Hikari 在启动时因连接失败而立即终止，允许初始化逻辑先行创建数据库
spring.datasource.hikari.initializationFailTimeout=0

# MyBatis-Plus配置
mybatis-plus.configuration.map-underscore-to-camel-case=true
mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.slf4j.Slf4jImpl
mybatis-plus.global-config.db-config.id-type=auto
mybatis-plus.global-config.db-config.logic-delete-field=deleted
mybatis-plus.global-config.db-config.logic-delete-value=1
mybatis-plus.global-config.db-config.logic-not-delete-value=0

# ========== Flyway 配置 ==========
# 默认启用 Flyway；如需禁用可设置为 false
spring.flyway.enabled=true
# 迁移脚本位置：classpath:db/migration 下的 V__ 格式文件
spring.flyway.locations=classpath:db/migration
# 允许在空库上执行，也允许第一次创建 baseline 以避免与已有库冲突
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true
spring.flyway.out-of-order=false

# ========== 应用内数据库初始化开关 ==========
# 为避免与 Flyway 冲突，默认关闭内置的 DatabaseInitializer（仅在明确需要建库时开启）
app.database-initializer.enabled=false

# Redis 配置（可选）
spring.data.redis.host=${REDIS_HOST:127.0.0.1}
spring.data.redis.port=${REDIS_PORT:6379}
#spring.data.redis.password=${REDIS_PASSWORD:}
#spring.data.redis.database=${REDIS_DB:0}
spring.data.redis.timeout=5s

# JWT 配置
app.jwt.secret=ChangeThisSecretToYourOwnAtLeast32BytesLength
app.jwt.expire-seconds=604800

# Token黑名单配置
# local: 本地内存存储（仅单机）, redis: Redis存储（支持集群）
app.token-blacklist.type=${TOKEN_BLACKLIST_TYPE:redis}

app.upstream.url=${APP_UPSTREAM_URL:http://127.0.0.1:57599}
app.subtitle.fusion.url=${APP_SUBTITLE_FUSION_URL:http://127.0.0.1:8081}

# 聊天历史条数默认值
app.chat.history-limit=${APP_CHAT_HISTORY_LIMIT:10}
app.chat.redis-ttl-seconds=${APP_CHAT_REDIS_TTL_SECONDS:86400}

app.upstream.video-download-url=${APP_UPSTREAM_VIDEO_DOWNLOAD_URL:http://127.0.0.1:57599}
app.upstream.subtitle-token=${APP_UPSTREAM_SUBTITLE_TOKEN:}
app.upstream.subtitle-download-url=${APP_UPSTREAM_SUBTITLE_DOWNLOAD_URL:http://127.0.0.1:8081/api/subtitles/download}

app.dh.default-models=${APP_DH_DEFAULT_MODELS:17552381569271.mp4,17552381752582.mp4,17552381860933.mp4,17552381977484.mp4,17552382060555.mp4,1755746810144韩杨分享的视频.mp4,b站男医生,test_bilibili_Dr}
app.dh.text-split-len=${APP_DH_TEXT_SPLIT_LEN:10}

# ========== RocketMQ 配置 ==========
# RocketMQ NameServer 地址
rocketmq.name-server=${ROCKETMQ_NAME_SERVER:127.0.0.1:9876}
# 生产者组
rocketmq.producer.group=video_generation_producer_group
# 生产者发送消息超时时间
rocketmq.producer.send-message-timeout=3000
# 生产者重试次数
rocketmq.producer.retry-times-when-send-failed=2

# ===== 日志配置 =====
logging.pattern.level=%5p [traceId=%X{traceId}]
logging.level.root=INFO
logging.level.com.zhongjia=INFO

# ===== Actuator / Health =====
management.endpoints.web.exposure.include=health,info
management.endpoint.health.probes.enabled=true
management.endpoint.health.show-details=never

# ===== 文件上传大小限制 =====
# 单个文件与整个请求的最大大小，默认 10MB，现放宽到 200MB
spring.servlet.multipart.max-file-size=${SPRING_MULTIPART_MAX_FILE_SIZE:200MB}
spring.servlet.multipart.max-request-size=${SPRING_MULTIPART_MAX_REQUEST_SIZE:200MB}

